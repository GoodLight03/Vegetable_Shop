<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org/">

<head th:replace="~{fragment/fragments::header}">

</head>

<body id="page-top">

    <!-- Page Wrapper -->
    <div id="wrapper">

        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">

            <!-- Main Content -->
            <div id="content">

                <!-- Topbar -->
                <nav th:replace="~{fragment/fragments::topbar}"></nav>
                <!-- End of Topbar -->
                <!-- Begin Page Content -->

                <input style="display: none;" type="number" class="form-control" id="nameEdit" name="name" th:value="${iShip}">

                <p th:if="${size == 0}">No Order</p>
                <div th:if="${success}" class="text-center alert alert-success">
                    <p th:text="${success}">
                    </p>
                </div>
                <div th:if="${error}" class="text-center alert alert-danger">
                    <p th:text="${error}"></p>
                </div>

                <select id="my-select" name="type" class="form-control">
                    <option th:value="null">-All-</option>
                    <option th:value="null">-Confirmed-</option>
                    <option th:value="null">-All-</option>
                </select>

                <table class="table table-striped tblType">
                    <thead>
                        <tr>
                            <th scope="col">Index</th>
                            <th scope="col">Customer</th>
                            <th scope="col">Order Date</th>
                            <th scope="col">Order Status</th>
                            <th scope="col">Address</th>
                            <th scope="col">Total Price</th>
                            <th scope="col">Payment Method</th>
                            <th scope="col">Action</th>
                        </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>

                <!-- End of Main Content -->

                <!-- Footer -->
                <footer th:replace="~{fragment/fragments::footer}"></footer>
                <!-- End of Footer -->

            </div>
            <!-- End of Content Wrapper -->
            <div class="row col-md-10">
                <form class="chiTietForm">
                    <div class="modal fade" id="chiTietModal" tabindex="-1" role="dialog"
                        aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog " role="document" style="width: 60%">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h3 class="title" style="text-align: center; font-weight: bolder;">Chi tiết sản phẩm
                                    </h3>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <div class="card">
                                        <div class="container-fliud">
                                            <div class="wrapper row">
                                                <div class="preview col-md-6">

                                                    <div class="preview-pic tab-content">
                                                        <div class="tab-pane active" id="pic-1">
                                                            <img style="width: 350px; height: 350px" class="hinhAnh" />
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="details col-md-6" style="font-size: 16px">
                                                    <p class="orderDate"></p>
                                                    <p class="orderStatus"></p>
                                                    <p class="hangSangXuat"></p>
                                                    <p class="tax"></p>
                                                    <p class="totalPrice"></p>
                                                    <p class="paymentMethod"></p>
                                                    <p class="heDieuHanh"></p>
                                                    <p class="manHinh"></p>
                                                    <p class="dungLuongPin"></p>
                                                    <p class="thongTinChung"></p>
                                                    <p class="baoHanh"></p>
                                                    <p class="donGia"></p>
                                                    <p class="donViKho"></p>
                                                    <p class="donViBan"></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- End of Page Wrapper -->
    <!-- Edit Category Modal -->
    <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Edit Type</h5>
                </div>
                <div class="modal-body">
                    <!-- <form th:action="@{/update-type}" method="put"> -->
                    <form>
                        <div class="form-group">
                            <label for="idEdit" class="col-form-label">ID Order
                            </label> <input type="text" class="form-control" id="idEdit" name="id" readonly>
                        </div>
                        <div class="form-group">
                            <label for="nameEdit" class="col-form-label">Shipper Name
                                Name</label> <select class="form-control shipper"></select>
                        </div>
                        <button type="submit" class="btn btn-primary btnUpdateForm">Save</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Scroll to Top Button-->
    <a th:replace="~{fragment/fragments::scroll}"></a>
    <!-- End -->
    <!-- Bootstrap core JavaScript-->
    <div th:replace="~{fragment/fragments::script}"></div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script th:src="@{/js/categories.js}"></script>
    <script>
        $(document).ready(function () {

            ajaxGet();

            console.log($('#nameEdit').val());
            
            function ajaxGet() {
                
                $.ajax({
                    type: "GET",
                    url: "http://localhost:8888/api/order/all?idShip="+$('#nameEdit').val(),
                    success: function (result) {
                        $.each(result, function (i, danhMuc) {
                            // var clas='my-product-image' + danhMuc.id;
                            var danhMucRow = '<tr>' +
                                '<td >' + danhMuc.id + '</td>' +
                                '<td>' + danhMuc.users.username + '</td>' +
                                '<td>' + danhMuc.orderDate + '</td>' +
                                '<td>' + danhMuc.orderStatus + '</td>' +
                                '<td>' + danhMuc.users.address + '</td>' +
                                '<td><p style="color: red">$' + danhMuc.totalPrice + '</p></td>' +
                                '<td>' + danhMuc.paymentMethod + '</td>' +
                                '<td>' + '<a href="/order-detail?id=' + danhMuc.id + '" class="button-cancel">Detail</a>' + '</td>';

                            if (danhMuc.orderStatus == 'Pending') {
                                danhMucRow +=
                                    '<td>' + '<input type="hidden" value=' + danhMuc.id + '>'
                                    + '<button class="btn btn-primary btnCapNhatDanhMuc" >Confirm</button>' +
                                    '<button class="btn btn-danger btnXoaDanhMuc">Cancel</button></td>';
                            }
                            danhMucRow += '</tr>';

                            // $('.tblType tbody').append(danhMucRow);
                            $('.tblType tbody').append(danhMucRow);
                        });


                    },
                    error: function (e) {
                        alert("Error List: ", e);
                        console.log("Error", e);
                    }
                });
            };
        });


        $(document).on('click', '.btnUpdateForm', function (event) {
            event.preventDefault();
            var danhMucId = $(this).parent().find('input').val();
            // var formData = {
            //     status: '',
            // }
            console.log(danhMucId);
            $.ajax({
                async: false,
                type: "PATCH",
                contentType: "application/json",
                url: "http://localhost:8888/api/order/all/" + $('#idEdit').val() + '?status=Confirmed&idShip=' + $('.shipper').val(),
                //data: JSON.stringify(formData),
                // dataType : 'json',
                success: function (response) {
                    window.location.reload();
                    alert("Xác nhận thành công");

                },
                error: function (xhr, status, error) {
                    alert("Error!" + error);
                    console.log("ERROR: ", error);
                }
            });

        });

        $(document).on("click", ".btnXoaDanhMuc", function () {
            event.preventDefault();
            var danhMucId = $(this).parent().find('input').val();
            // var formData = {
            //     status: '',
            // }
            console.log(danhMucId);
            $.ajax({
                async: false,
                type: "PATCH",
                contentType: "application/json",
                url: "http://localhost:8888/api/order/all/" + danhMucId + '?status=Cancelled',
                //data: JSON.stringify(formData),
                // dataType : 'json',
                success: function (response) {
                    window.location.reload();
                    alert("Hủy thành công");

                },
                error: function (xhr, status, error) {
                    alert("Error!" + error);
                    console.log("ERROR: ", error);
                }
            });
        });

        $(document).on("click", ".btnCapNhatDanhMuc", function () {
            event.preventDefault();
            var danhMucId = $(this).parent().find('input').val();
            console.log(danhMucId);
            $('#idEdit').val(danhMucId);
            console.log($('.shipper').val());
            $('#editModal').modal();
        });


    </script>
</body>

</html>